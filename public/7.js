webpackJsonp([7],{"7elN":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=r("p/p5"),n=r("K23+"),i=(a=n)&&a.__esModule?a:{default:a},o=(r("nv24"),r("rN6N"));t.default={props:{mode:null,index:null,startIndex:{default:1},order:{default:null,type:o.Order}},created:function(){this.order.setReminder(this.mode)},methods:{logReminder:function(){var e=this;this.$LIPS(!0),delete this.order.reminder.order,delete this.order.reminder.canBeSelected,(0,s.post)("/api/reminder",{reminders:[this.order.reminder]}).then(function(t){return t.data.saved&&e.logPromiseCall()}).catch(function(){return e.$displayErrorMessage("Error Logging reminders!")})},logPromiseCall:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Reminder Logged!";this.order.promiseCall.date?(0,s.post)("/api/promise_call",this.order.promiseCall).then(function(r){return r.data.saved&&e.done(t+" Promise call added!")}).catch(function(){return e.$displayErrorMessage("Error Logging promise call!")}):this.done(t)},done:function(e){this.$scrollToTop(),i.default.setSuccess(e,5e3),this.$emit("done")},toggleSelect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.order.reminder.canBeSelected&&(this.order.isSelected=null!==e?e:!this.order.isSelected)}}}},J74z:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("transition",{attrs:{name:"fade"}},[r("div",{attrs:{id:"reminder"}},[r("div",{staticClass:"mt-5 mb-3 attendance-head"},[r("ul",{staticClass:"nav nav-tabs justify-content-center p-0",attrs:{role:"tablist"}},[e.mode("call")?r("li",{staticClass:"col p-0 nav-item mb-0"},[r("a",{staticClass:"nav-link active",attrs:{"aria-selected":"true","data-toggle":"tab",href:"#reminder-panel",role:"tab"},domProps:{innerHTML:e._s("Promise "+e.mode())},on:{click:function(t){e.listToOrder=8}}})]):e._e(),e._v(" "),e._l(e.details.tabs,function(t,a){return r("li",{key:a,staticClass:"col p-0 nav-item mb-0"},[r("a",{staticClass:"nav-link",class:0===a&&!e.mode("call")&&"active",attrs:{"aria-selected":"true","data-toggle":"tab",href:"#reminder-panel",role:"tab"},domProps:{innerHTML:e._s(t+" "+e.mode())},on:{click:function(t){e.listToOrder=e.details.list+a}}})])})],2)]),e._v(" "),r("div",{staticClass:"mt-5 mb-3 attendance-head"},[r("div",{staticClass:"row px-4 pt-3 pb-4 text-center"},[r("div",{staticClass:"col light-heading"},[e._v("Action")]),e._v(" "),e._l(e.details.headings,function(t){return r("div",{staticClass:"col light-heading"},[e._v(e._s(t))])})],2)]),e._v(" "),r("order",{attrs:{list:e.listToOrder,mode:e.mode()}})],1)])},staticRenderFns:[]}},MCfq:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,".attendance-head .light-heading[data-v-05a38760]:first-child{max-width:120px}",""])},QGjH:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,".table-separator[data-v-6705b910]{border-top:2px solid #dee1e4}",""])},TZKk:function(e,t,r){var a=r("VU/8")(r("7elN"),r("b4Eb"),!1,null,null,null);e.exports=a.exports},XPj8:function(e,t,r){var a=r("VU/8")(r("aSpy"),r("bLuX"),!1,function(e){r("lr/n")},"data-v-6705b910",null);e.exports=a.exports},aSpy:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=m(r("Xxa5")),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},n=m(r("I3G/")),i=r("NYxO"),o=m(r("K23+")),d=r("m2tk"),l=r("p/p5"),c=m(r("TZKk")),u=r("rN6N");function m(e){return e&&e.__esModule?e:{default:e}}function v(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function a(s,n){try{var i=t[s](n),o=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)});e(o)}("next")})}}t.default={components:{OrderItem:c.default},props:{list:{default:null},mode:null,preLoadedOrder:null,startIndex:null},watch:{list:function(e){this.fetchList(e)},preLoadedOrder:function(e){this.prepareForm(e)}},data:function(){return{orders:[],show:!1,showModalContent:!1,Order:u.Order,activeOrder:null}},computed:s({},(0,i.mapGetters)(["auth","getAuthUserDetails"])),methods:{prepareForm:function(){var e=v(a.default.mark(function e(t){var r=t.orders;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.show=!1,this.showModalContent=!1,e.next=4,this.convertRequestOrdersToOrderClassInstance(r);case 4:this.orders=e.sent,this.orders.length&&(this.show=!0),this.$LIPS(!1);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),convertRequestOrdersToOrderClassInstance:function(e){var t=[];for(var r in e){var a=e[r]instanceof u.Order?e[r]:new u.OrderWithPromiseCall(e[r],this.getAuthUserDetails.userId);t.push(a)}return t},fetchList:function(e){var t=this;this.$LIPS(!0);var r,a=!(this.auth("DVALead")||this.auth("FSLLead")||this.auth("CAGAccess"));(0,l.get)((r={query:{list:e,filterWithBranch:a}},"/api/reminder/create?list="+r.query.list+(r.query.filterWithBranch?"&filterWithBranch="+r.query.filterWithBranch:""))).then(function(r){var a=r.data;8===e&&(a.orders=a.orders.map(function(e){return e.order})),t.prepareForm(a)})},displayDetails:function(){var e=v(a.default.mark(function e(t,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.default.set(this.$data,"activeOrder",t);case 2:return this.showModalContent=!0,e.abrupt("return",$("#"+r).modal("toggle"));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),processSelected:function(){this.$LIPS(!0);var e=this.orders.filter(function(e){return e.isSelected});if(!e.length)return this.$displayErrorMessage("please select at least one!"),this.$LIPS(!1);this.sendSMSReminders(e)},sendSMSReminders:function(e){var t=this,r=[];e.forEach(function(a,s){var n=new d.Message(a.nextSMSReminder,a.reminder.contacts,!1,a.dvaId);n.send(function(a){200===a.status&&(delete n.logToDB,r.push(n)),s+1===e.length&&t.logSentMessages(e,r)})})},logSentMessages:function(e,t){var r=this;t.length>0?(0,l.post)("/api/message",{messages:t,bulk:!0}).then(function(t){var a=t.data,s=a.sentAndLogged,n=a.ids;s?r.logSentReminders(e,n):r.$displayErrorMessage("Error Logging sent sms details!")}):this.$displayErrorMessage("Error sending messages!")},logSentReminders:function(e,t){var r=this;if(t.reverse(),t.length>0){var a=e.map(function(e,r){return e.reminder.sms_id=t[r],delete e.reminder.contacts,delete e.reminder.canBeSelected,e.reminder});(0,l.post)("/api/reminder",{reminders:a}).then(function(e){e.data.saved?(o.default.setSuccess("Reminders have been sent successfully!",5e4),r.fetchList(r.list)):r.$displayErrorMessage("Error sending reminders!"),r.$scrollToTop()})}else this.$displayErrorMessage("Error logging sent messages!")}},mounted:function(){var e=this;"normal-list"!=this.mode?this.fetchList(this.list):this.prepareForm(this.preLoadedOrder),$(document).on("hidden.bs.modal",".modal",function(){e.activeOrder=null,e.showModalContent=!1})},created:function(){this.$prepareBanks(),this.$prepareBranches(),this.$preparePaymentMethods()}}},b4Eb:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"mb-3 row attendance-item"},[r("div",{staticClass:"col-12 col-xs-2 col-md col-lg d-flex align-items-center",staticStyle:{"max-width":"120px"}},["normal-list"===e.mode?r("span"):e.order.reminder.canBeSelected&&["collection","recovery","call","external-recovery"].includes(e.mode)?r("span",{staticClass:"user mx-auto bg-pending text-white",on:{click:e.logReminder}},[r("i",{staticClass:"fas fa-hourglass-start"})]):e.order.reminder.canBeSelected&&"sms"===e.mode?r("div",{staticClass:"d-flex align-items-center"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.order.isSelected,expression:"order.isSelected"}],staticClass:"form-check-input my-0 mx-4 float-left position-relative ",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.order.isSelected)?e._i(e.order.isSelected,null)>-1:e.order.isSelected},on:{click:e.toggleSelect,change:function(t){var r=e.order.isSelected,a=t.target,s=!!a.checked;if(Array.isArray(r)){var n=e._i(r,null);a.checked?n<0&&e.$set(e.order,"isSelected",r.concat([null])):n>-1&&e.$set(e.order,"isSelected",r.slice(0,n).concat(r.slice(n+1)))}else e.$set(e.order,"isSelected",s)}}})]):r("span",{staticClass:"user mx-auto sent-reminder"},[r("i",{staticClass:"fas fa-check"})]),e._v(" "),r("span",{staticClass:"user mx-auto"},[e._v(e._s(e.startIndex+e.index))])]),e._v(" "),r("div",{staticClass:"col-12 col-xs-2 col-md col-lg user-name d-flex align-items-center justify-content-center"},[e._v("\n        "+e._s(e.$vnode.key)+"\n    ")]),e._v(" "),r("div",{staticClass:"col-12 col-xs-2 col-md col-lg d-flex align-items-center justify-content-center",attrs:{"data-hoverable":"true"},on:{click:function(t){e.$emit("display",e.order,"purchase_order")}}},[e._v("\n        "+e._s(e.order.order.order_date)+"\n    ")]),e._v(" "),r("div",{staticClass:"col-12 col-xs-3 col-md col-lg d-flex align-items-center justify-content-center",attrs:{"data-hoverable":"true"},on:{click:function(t){e.$emit("display",e.order,"customer_info")}}},[e._v("\n        ID: "+e._s(e.order.customer.id)+" - "+e._s(e._f("capitalize")(e.order.customer.employment_status))+"\n    ")]),e._v(" "),r("div",{staticClass:"col-12 col-xs-2 col-md col-lg d-flex align-items-center justify-content-center",attrs:{"data-hoverable":"true"},on:{click:function(t){e.$emit("display",e.order,"repayment")}}},[e._v("\n        "+e._s(e.order.financialStatus)+"\n    ")]),e._v(" "),r("div",{staticClass:"col-12 col-xs-2 col-md col-lg d-flex align-items-center justify-content-center",attrs:{"data-hoverable":"true"},on:{click:function(t){e.$emit("display",e.order,"reminder_history")}}},[e._v("\n        "+e._s(e.order.order.reminders.length)+" reminder(s) sent\n    ")]),e._v(" "),["collection","recovery","external-recovery"].includes(e.mode)?r("div",{staticClass:"col-12 col-xs-2 col-md col-lg d-flex align-items-center attendance-create"},[r("span",{staticClass:"present"},[r("span",{staticClass:"radio w-50 pr-3 mb-0 float-left"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.order.reminder.is_visited,expression:"order.reminder.is_visited"}],attrs:{type:"radio",id:"present"+e.index,name:"isPresent"+e.index},domProps:{value:!0,checked:e._q(e.order.reminder.is_visited,!0)},on:{change:function(t){e.$set(e.order.reminder,"is_visited",!0)}}}),e._v(" "),r("label",{attrs:{for:"present"+e.index}},[e._v("yes")])]),e._v(" "),r("span",{staticClass:"radio w-50 pl-3 mb-0 float-left"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.order.reminder.is_visited,expression:"order.reminder.is_visited"}],attrs:{type:"radio",id:"absent"+e.index,name:"isPresent"+e.index},domProps:{value:!1,checked:e._q(e.order.reminder.is_visited,!1)},on:{change:function(t){e.$set(e.order.reminder,"is_visited",!1)}}}),e._v(" "),r("label",{attrs:{for:"absent"+e.index}},[e._v("no")])])])]):e._e(),e._v(" "),["collection","recovery","call","external-recovery"].includes(e.mode)?r("div",{staticClass:"col-12 col-xs-2 col-md col-lg d-flex align-items-center"},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.order.reminder.feedback,expression:"order.reminder.feedback"}],staticClass:"form-control",attrs:{rows:"1",disabled:!e.order.reminder.canBeSelected},domProps:{value:e.order.reminder.feedback},on:{input:function(t){t.target.composing||e.$set(e.order.reminder,"feedback",t.target.value)}}})]):e._e(),e._v(" "),"call"===e.mode?r("div",{staticClass:"col-12 col-xs-2 col-md col-lg d-flex align-items-center"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.order.promiseCall.date,expression:"order.promiseCall.date"}],staticClass:"form-control",attrs:{type:"date",disabled:!e.order.reminder.canBeSelected},domProps:{value:e.order.promiseCall.date},on:{input:function(t){t.target.composing||e.$set(e.order.promiseCall,"date",t.target.value)}}})]):e._e()])},staticRenderFns:[]}},bLuX:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.show?r("div",{staticClass:"tab-content mt-1 attendance-body"},[r("div",{staticClass:"tab-pane active text-center",attrs:{id:"reminder-panel",role:"tabpanel"}},e._l(e.orders,function(t,a){return r("order-item",{key:t.order.id,attrs:{index:a,"start-index":e.startIndex,order:t,mode:e.mode},on:{done:function(t){e.fetchList(e.list)},display:e.displayDetails}})})),e._v(" "),"normal-list"!=e.mode?r("div",{staticClass:"w-100 my-5 mx-0 hr"}):e._e()]):r("div",{staticClass:"tab-content mt-1 attendance-body"},[e._m(0)]),e._v(" "),e.show&&"sms"===e.mode?r("div",{staticClass:"mt-1 attendance-body"},[r("div",{staticClass:"mb-5 px-0 row align-items-center"},[r("div",{staticClass:"clearfix d-flex justify-content-end w-100"},[r("button",{staticClass:"btn bg-default",attrs:{disabled:e.$isProcessing},on:{click:e.processSelected}},[e._v("\n                    Send Reminder(s) "),r("i",{staticClass:"far fa-paper-plane ml-1"})])])])]):e._e(),e._v(" "),r("div",{staticClass:"modal fade",attrs:{id:"purchase_order"}},[r("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[r("div",{staticClass:"modal-content"},[e._m(1),e._v(" "),e.showModalContent?r("div",{staticClass:"modal-body"},[r("div",{staticClass:"table-responsive"},[r("table",{staticClass:"table table-bordered table-striped"},[r("tbody",[r("tr",[r("th",[e._v("Order ID")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.order.id))])]),e._v(" "),r("tr",[r("th",[e._v("Order date")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.order.order_date))])]),e._v(" "),r("tr",[r("th",[e._v("Product")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.order.store_product.product_name))])]),e._v(" "),r("tr",[r("th",[e._v("Repayment")]),e._v(" "),r("td",[e._v(e._s(e.$formatCurrency(e.activeOrder.amountsToBePaid[0])))])]),e._v(" "),r("tr",[r("th",[e._v("Down Payment")]),e._v(" "),r("td",[e._v(e._s(e.$formatCurrency(e.activeOrder.order.down_payment)))])]),e._v(" "),r("tr",[r("th",[e._v("Discount (%)")]),e._v(" "),r("td",[e._v(e._s(e._f("capitalize")(e.activeOrder.discount)))])]),e._v(" "),r("tr",[r("th",[e._v("Sale Type")]),e._v(" "),r("td",[e._v(e._s(e._f("capitalize")(e.activeOrder.order.sales_type.name)))])]),e._v(" "),r("tr",[r("th",[e._v("Total amount to Pay")]),e._v(" "),r("td",[e._v(e._s(e.$formatCurrency(e.activeOrder.order.product_price)))])]),e._v(" "),r("tr",[r("th",[e._v("Processed by")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.order.floor_agent?e.activeOrder.order.floor_agent.full_name:null)+"\n                                ")])])])])])]):e._e(),e._v(" "),e._m(2)])])]),e._v(" "),r("div",{staticClass:"modal fade",attrs:{id:"customer_info"}},[r("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[r("div",{staticClass:"modal-content"},[e._m(3),e._v(" "),e.showModalContent?r("div",{staticClass:"modal-body"},[r("div",{staticClass:"table-responsive"},[r("table",{staticClass:"table table-bordered table-striped"},[r("tbody",[r("tr",[r("th",[e._v("Customer ID")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customer.id))])]),e._v(" "),r("tr",[r("th",[e._v("Full Name")]),e._v(" "),r("td",[e._v(e._s(e.$getCustomerFullName(e.activeOrder.customer)))])]),e._v(" "),r("tr",[r("th",[e._v("Address")]),e._v(" "),r("td",[e._v(e._s(e.$getCustomerAddress(e.activeOrder.customer)))])]),e._v(" "),r("tr",[r("th",[e._v("Phone")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customer.telephone))])]),e._v(" "),r("tr",[r("th",[e._v("Branch")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customer.branch.name))])]),e._v(" "),r("tr",[r("th",[e._v("Category")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customer.employment_status))])]),e._v(" "),r("tr",[r("th",[e._v("Work guarantor name")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customerWGName)+"\n                                ")])]),e._v(" "),r("tr",[r("th",[e._v("Work guarantor phone")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customer.work_guarantor_telno))])]),e._v(" "),r("tr",[r("th",[e._v("Personal guarantor name")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customerPGName)+"\n                                ")])]),e._v(" "),r("tr",[r("th",[e._v("Personal guarantor phone")]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.customer.personal_guarantor_telno))])]),e._v(" "),r("tr",[r("th",[e._v("Verified by")]),e._v(" "),r("td",[r("router-link",{staticClass:"text-link",attrs:{target:"_blank",to:"/dva/verification?id="+e.activeOrder.customer.id}},[e._v("\n                                        click here to see verifications status\n                                    ")])],1)])])])])]):e._e(),e._v(" "),e._m(4)])])]),e._v(" "),r("div",{staticClass:"modal fade repayment",attrs:{id:"repayment"}},[r("div",{staticClass:"modal-dialog modal-xl",attrs:{role:"document"}},[e.showModalContent?r("div",{staticClass:"modal-content"},[r("div",{staticClass:"modal-header py-2"},[r("h6",{staticClass:"modal-title py-1"},[e._v("\n                        Repayment Plan/Summary - "+e._s(e._f("capitalize")(e.activeOrder.customer.employment_status))+"\n                    ")]),e._v(" "),e._m(5)]),e._v(" "),r("div",{staticClass:"modal-body"},[r("div",{staticClass:"table-responsive"},[r("h5",{staticClass:"mt-3 mb-0"},[e._v("Order Information")]),e._v(" "),r("table",{staticClass:"table table-bordered"},[r("tbody",[e._m(6),e._v(" "),r("tr",[r("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.activeOrder.customerName)+"\n                                ")]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.order.id))]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.order.store_product.product_name))]),e._v(" "),r("td",[e._v(e._s(e.activeOrder.branch.name))]),e._v(" "),r("td",{staticClass:"font-weight-bold",class:"ok"===e.activeOrder.order.status.name.toLocaleString()?"paid":"missed"},[e._v("\n                                    "+e._s(e.activeOrder.order.status.name)+"\n                                ")])])])]),e._v(" "),r("h5",{staticClass:"mt-5 mb-0"},[e._v("Amortization Schedule")]),e._v(" "),r("table",{staticClass:"table table-bordered"},[r("tbody",{staticClass:"text-center"},[r("tr",[r("th",[e._v("Repayment")]),e._v(" "),e._l(e.activeOrder.repaymentCaptions,function(t){return r("td",{domProps:{innerHTML:e._s(t)}})})],2),e._v(" "),r("tr",{staticClass:"table-separator"},[r("th",[e._v("Due Date")]),e._v(" "),e._l(e.activeOrder.dueDates,function(t){return r("td",[e._v(e._s(t))])})],2),e._v(" "),r("tr",[r("th",[e._v("Actual Pay Day")]),e._v(" "),e._l(e.activeOrder.actualPayDates,function(t){return r("td",[e._v(e._s(t))])})],2),e._v(" "),r("tr",{staticClass:"table-separator"},[r("th",[e._v("Status")]),e._v(" "),e._l(e.activeOrder.paymentStatusClasses,function(e){return r("td",{class:e.class},[r("i",{staticClass:"fas",class:e.icon})])})],2),e._v(" "),r("tr",{staticClass:"table-separator"},[r("th",[e._v("Repayment Amount")]),e._v(" "),e._l(e.activeOrder.amountsToBePaid,function(t){return r("td",[e._v(e._s(e.$formatCurrency(t)))])})],2),e._v(" "),r("tr",[r("th",[e._v("Actual Amount Paid")]),e._v(" "),e._l(e.activeOrder.actualAmountsPaid,function(t){return r("td",[e._v(e._s(e.$formatCurrency(t))+"\n                                ")])})],2),e._v(" "),r("tr",{staticClass:"table-separator"},[r("th",[e._v("Payment Method")]),e._v(" "),e._l(e.activeOrder.paymentMethods,function(t){return r("td",{staticClass:"text-capitalize"},[e._v("\n                                    "+e._s(e.Order.convertToName(t,"paymentMethods"))+"\n                                ")])})],2),e._v(" "),r("tr",[r("th",[e._v("Bank")]),e._v(" "),e._l(e.activeOrder.paymentBanks,function(t){return r("td",{staticClass:"text-capitalize"},[e._v("\n                                    "+e._s(e.Order.convertToName(t,"banks"))+"\n                                ")])})],2)])]),e._v(" "),r("h5",{staticClass:"mt-5 mb-0"},[e._v("Payment Summary")]),e._v(" "),r("table",{staticClass:"table table-bordered"},[r("tbody",{staticClass:"text-center"},[r("tr",{staticClass:"table-separator"},[r("td",{staticClass:"text-left"},[e._v("Discount Detail (%)")]),e._v(" "),r("th",[e._v(e._s(e._f("capitalize")(e.activeOrder.discount)))]),e._v(" "),r("td",[e._v("Total Before Discount")]),e._v(" "),r("th",[e._v(e._s(e.$formatCurrency(e.$roundDownAmt(e.activeOrder.order.product_price))))]),e._v(" "),r("td",[e._v("Total Paid")]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.amountPaid))])]),e._v(" "),r("tr",[r("td",{staticClass:"text-left"},[e._v("Discount Amount")]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.discountAmount))]),e._v(" "),r("td",[e._v("Total After Discount")]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.discountedTotal))]),e._v(" "),r("td",[e._v("Total Debt")]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.outstandingDebt))])]),e._v(" "),r("tr",[r("td",{staticClass:"text-left"},[e._v("Down Payment")]),e._v(" "),r("th",[e._v(e._s(e.$formatCurrency(e.$roundDownAmt(e.activeOrder.order.down_payment))))]),e._v(" "),r("td",[e._v("Total Plus Default Fee")]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.totalPlusDefault))]),e._v(" "),r("td",[e._v("Default Fee")]),e._v(" "),r("th",[e._v(e._s(e.activeOrder.defaultFee))])])])])])]),e._v(" "),e._m(7)]):e._e()])]),e._v(" "),r("div",{staticClass:"modal fade repayment",attrs:{id:"reminder_history"}},[r("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[r("div",{staticClass:"modal-content"},[e._m(8),e._v(" "),e.showModalContent?r("div",{staticClass:"modal-body"},[r("div",{staticClass:"table-responsive"},[e.activeOrder.order.reminders.length?r("table",{staticClass:"table table-bordered table-striped"},[e._m(9),e._v(" "),r("tbody",e._l(e.activeOrder.order.reminders,function(t,a){return r("tr",[r("th",[e._v(e._s(a+1))]),e._v(" "),r("td",[e._v(e._s(e.$dateTimeConvert(t.date)))]),e._v(" "),r("td",[e._v(e._s(t.type))]),e._v(" "),r("td",{domProps:{innerHTML:e._s(e.Order.renderMessage(t))}}),e._v(" "),r("td",[e._v(e._s(t.user.full_name))])])}))]):r("div",{staticClass:"my-4 text-center"},[e._v("\n                            no reminders have been sent yet!\n                        ")])])]):e._e(),e._v(" "),e._m(10)])])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tab-pane active text-center"},[t("div",{staticClass:"mb-3 row attendance-item"},[t("div",{staticClass:"col d-flex light-heading align-items-center justify-content-center"},[this._v("\n                    No records found!\n                ")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-header py-2"},[t("h6",{staticClass:"modal-title py-1"},[this._v("Purchase Order Summary")]),this._v(" "),t("a",{staticClass:"close py-1",attrs:{"aria-label":"Close","data-dismiss":"modal"}},[t("span",{staticClass:"modal-close text-danger",attrs:{"aria-hidden":"true"}},[t("i",{staticClass:"fas fa-times"})])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-footer"},[t("a",{staticClass:"text-link mt-3 w-100",staticStyle:{"text-align":"right"},attrs:{"data-dismiss":"modal",href:"javascript:"}},[this._v("close dialogue")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-header py-2"},[t("h6",{staticClass:"modal-title py-1"},[this._v("Customer Info. Summary")]),this._v(" "),t("a",{staticClass:"close py-1",attrs:{"aria-label":"Close","data-dismiss":"modal"}},[t("span",{staticClass:"modal-close text-danger",attrs:{"aria-hidden":"true"}},[t("i",{staticClass:"fas fa-times"})])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-footer"},[t("a",{staticClass:"text-link mt-3 w-100 text-right",attrs:{"data-dismiss":"modal",href:"#"}},[this._v("\n                        close dialogue\n                    ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"close py-1",attrs:{"aria-label":"Close","data-dismiss":"modal"}},[t("span",{staticClass:"modal-close text-danger",attrs:{"aria-hidden":"true"}},[t("i",{staticClass:"fas fa-times"})])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("tr",{staticClass:"table-separator"},[r("td",[e._v("Name")]),e._v(" "),r("td",[e._v("Order Id")]),e._v(" "),r("td",[e._v("Product")]),e._v(" "),r("th",[e._v("Branch")]),e._v(" "),r("th",[e._v("Status")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-footer d-flex justify-content-end"},[t("a",{staticClass:"text-link mt-3",attrs:{"data-dismiss":"modal",href:"javascript:"}},[this._v("close dialogue")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-header py-2"},[t("h6",{staticClass:"modal-title py-1"},[this._v("History")]),this._v(" "),t("a",{staticClass:"close py-1",attrs:{"aria-label":"Close","data-dismiss":"modal"}},[t("span",{staticClass:"modal-close text-danger",attrs:{"aria-hidden":"true"}},[t("i",{staticClass:"fas fa-times"})])])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("thead",[r("tr",[r("th",[e._v("S/N")]),e._v(" "),r("th",[e._v("Date")]),e._v(" "),r("th",[e._v("Type")]),e._v(" "),r("th",[e._v("SMS/Feedback")]),e._v(" "),r("th",[e._v("sender")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"modal-footer"},[t("a",{staticClass:"text-link mt-3 w-100",staticStyle:{"text-align":"right"},attrs:{"data-dismiss":"modal",href:"javascript:"}},[this._v("close dialogue")])])}]}},dBli:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=r("XPj8"),n=(a=s)&&a.__esModule?a:{default:a};function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.default={components:{Order:n.default},data:function(){return{listToOrder:null}},methods:{mode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$route.meta.mode.toLowerCase();return e?t===e:t}},computed:{details:function(){var e=1,t=["1<sup>st</sup>","2<sup>nd</sup>","3<sup>rd</sup>"],r=["Order Number","Order Summary","Customer Info Summary","Repayment Summary","History"];switch(this.mode()){case"call":e=4,t=[].concat(i(t),["Guarantor's"]),r=[].concat(i(r),["Feedback","Promise Date"]);break;case"collection":e=9,t.splice(2,1),r=[].concat(i(r),["Visited?","Feedback"]);break;case"recovery":e=11,r=[].concat(i(r),["Visited?","Feedback"]);break;case"external-recovery":e=14,t.splice(1,2),r=[].concat(i(r),["Delivered Letter?","Feedback"])}return this.mode("call")?this.listToOrder=8:this.listToOrder||(this.listToOrder=e),{tabs:t,headings:r,list:e}}}}},iNcs:function(e,t,r){var a=r("VU/8")(r("dBli"),r("J74z"),!1,function(e){r("lMby")},"data-v-05a38760",null);e.exports=a.exports},lMby:function(e,t,r){var a=r("MCfq");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r("rjj0")("54595b2c",a,!0,{})},"lr/n":function(e,t,r){var a=r("QGjH");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r("rjj0")("ab38e84a",a,!0,{})},rN6N:function(e,t,r){"use strict";var a,s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=r("I3G/"),i=(a=n)&&a.__esModule?a:{default:a},o=r("N71M");function d(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=new i.default,u=function(){function e(t,r){l(this,e),this._order=t,this._customer=r,this._paymentBanks=[],this._paymentMethods=[],this._actualPayDates=[],this._actualAmountsPaid=[],this._amountsToBePaid=[],this._repaymentCaptions=[],this._paymentStatusClasses=[],this._repaymentLevel=0,this._amountPaid=null,this._discountAmount=null,this._outstandingDebt=null,this._discountedTotal=null,this._defaultFee=null,this._totalPlusDefault=null,this._payments={},this.setIsOrderFormal(),this.setIsRepaymentValid(),this.setRepaymentData(),this.setCountAndInterval(),this.setCommonDetails(),this.setDueDates(),this.setPaymentStatusClasses(),this.calcAndSetPaymentSummary(),this.setBranch(),this.setDiscount()}return s(e,[{key:"setIsRepaymentValid",value:function(){this._isRepaymentValid=!(!this.order.repayment_formal&&!this.order.repayment_informal)}},{key:"setIsOrderFormal",value:function(){this._isOrderFormal=["formal","salaried"].includes(this._customer.employment_status.toLowerCase()),4===parseInt(this.order.payment_method_id)&&(this._isOrderFormal=!0)}},{key:"setRepaymentData",value:function(){null!=this.order.repayment_formal&&(this._repaymentData=this.order.repayment_formal),null!=this.order.repayment_informal&&(this._repaymentData=this.order.repayment_informal)}},{key:"setCountAndInterval",value:function(){var t=void 0,r=void 0;new Date(this.order.order_date)<=new Date("2019-07-07")?(null!=this.order.repayment_formal&&(t=28,r=6),null!=this.order.repayment_informal&&(t=14,r=12)):e.isBankDraftAvailable()&&this.isOrderFormal||4===parseInt(this.order.payment_method_id)?(t=28,r=6):(t=14,r=12),this._count=r,this._interval=t}},{key:"setDueDates",value:function(){this._dueDates=e.generateDueDates(this.order.order_date,this.interval,this.count)}},{key:"setCommonDetails",value:function(){if(this.isRepaymentValid)for(var e=1;e<this.count+1;e++){for(var t=c.$getColumn(e).split(""),r=[],a=1;a<=2;a++)r.unshift(t.pop());this._repaymentCaptions.push("<td>"+t.join("")+"<sup>"+r.join("")+"</sup></td>"),this._actualPayDates.push(this.repaymentData[c.$getColumn(e)+"_date"]),this._actualAmountsPaid.push(this.repaymentData[c.$getColumn(e)+"_pay"]),this._paymentBanks.push(this.repaymentData[c.$getColumn(e)+"_payment_bank"]),this._paymentMethods.push(this.repaymentData[c.$getColumn(e)+"_payment_method"]),this._amountsToBePaid.push(c.$roundDownAmt(this.order.repayment_amount)),this.repaymentData[c.$getColumn(e)+"_pay"]>0&&this._repaymentLevel++}}},{key:"setBranch",value:function(){var e=this;this.order.store_product?this._branch=o.store.state.branches.find(function(t){return parseInt(t.id)===parseInt(e.order.store_product.store_name)}):this._branch=null}},{key:"setPaymentStatusClasses",value:function(){if(this.isRepaymentValid)for(var t=1;t<this.count+1;t++){var r={class:null,icon:null},a=c.$getColumn(t),s=e.isPaymentDue(this.dueDates[t-1]),n=parseInt(this.repaymentData[a+"_pay"]);n?(r.class="paid",r.icon="fa-check"):s&&!n?(r.class="missed",r.icon="fa-times"):s||(r.class="pending",r.icon="fa-hourglass-start"),this._paymentStatusClasses.push(r)}}},{key:"calcAndSetPaymentSummary",value:function(){var e=function(e){return c.$formatCurrency(e)},t=this.order,r=t.repayment_amount,a=t.down_payment,s=t.product_price,n=6===this.count?.5:1,i=this.order.discount.percentage_discount,o=i>0?5===i?1:2:0,d=c.$roundDownAmt(r*n*o);this._discountAmount=e(d);var l=0,u=0;if(this.repaymentData){for(var m=0;m<this.count+1;m++){var v=parseInt(this.actualAmountsPaid[m]);u+=v?c.$roundDownAmt(v):0}l=c.$roundDownAmt(parseInt(a))+u+d}this._amountPaid=e(l);var _=c.$roundDownAmt(s-d);this._discountedTotal=e(_);var h=0;new Date(this.order.order_date)>new Date("2019-07-07")&&(h=500*[].length),this._defaultFee=e(h),this._totalPlusDefault=e(_+h),this._outstandingDebt=e(c.$roundDownAmt(parseInt(s)-l))}},{key:"setDiscount",value:function(){this._discount=this.order.discount.name+" "+this.order.discount.percentage_discount}},{key:"payments",set:function(e){this._payments=e},get:function(){return this._payments}},{key:"repaymentLevel",get:function(){return this._repaymentLevel}},{key:"order",get:function(){return this._order}},{key:"customer",get:function(){return this._customer}},{key:"isRepaymentValid",get:function(){return this._isRepaymentValid}},{key:"isOrderFormal",get:function(){return this._isOrderFormal}},{key:"repaymentData",get:function(){return this._repaymentData}},{key:"count",get:function(){return this._count}},{key:"interval",get:function(){return this._interval}},{key:"dueDates",get:function(){return this._dueDates}},{key:"paymentStatusClasses",get:function(){return this._paymentStatusClasses}},{key:"repaymentCaptions",get:function(){return this._repaymentCaptions}},{key:"paymentBanks",get:function(){return this._paymentBanks}},{key:"paymentMethods",get:function(){return this._paymentMethods}},{key:"actualPayDates",get:function(){return this._actualPayDates}},{key:"actualAmountsPaid",get:function(){return this._actualAmountsPaid}},{key:"amountsToBePaid",get:function(){return this._amountsToBePaid}},{key:"amountPaid",get:function(){return this._amountPaid}},{key:"discountAmount",get:function(){return this._discountAmount}},{key:"outstandingDebt",get:function(){return this._outstandingDebt}},{key:"discountedTotal",get:function(){return this._discountedTotal}},{key:"defaultFee",get:function(){return this._defaultFee}},{key:"totalPlusDefault",get:function(){return this._totalPlusDefault}},{key:"branch",get:function(){return this._branch}},{key:"discount",get:function(){return this._discount}},{key:"customerName",get:function(){return this.customer.first_name+" "+this.customer.last_name}},{key:"customerWGName",get:function(){var e=this.customer;return e.work_guarantor_first_name+" "+e.work_guarantor_last_name+" - "+e.work_guarantor_relationship}},{key:"customerPGName",get:function(){var e=this.customer;return e.personal_guarantor_first_name+" "+e.personal_guarantor_last_name+" - "+e.personal_guarantor_relationship}}],[{key:"generateDueDates",value:function(e,t,r){for(var a=[],s=0;s<r;s++){var n=new Date(e).addDays((s+1)*t),i=c.$getDate(n);a.push(i)}return a}},{key:"isPaymentDue",value:function(e){return new Date>new Date(e)}},{key:"isBankDraftAvailable",value:function(){return!1}},{key:"renderMessage",value:function(e){return e.sms?e.sms.message.replace(/%0a/g,"</br>"):e.feedback}},{key:"convertToName",value:function(e,t){return e?o.store.state[t].find(function(t){return t.id===e}).name:null}}]),e}(),m=function(e){function t(e,r){l(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,e.customer));return a._isReminderSent=!1,a._dvaId=r,a._isSelected=!1,a.setReminder(null),a.setIsReminderSent(),a.setFinancialStatus(),a.setPromiseCall(),a.generateAndSetNextSMSReminder(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u),s(t,[{key:"setIsReminderSent",value:function(){var e=this,t=c.$getDate();this.order.reminders.forEach(function(r){var a=r.date.split(" "),s=a[0].split("-"),n=a[1].split(":"),i=[].concat(d(s),d(n)).map(function(e){return parseInt(e,10)});c.$getDate(new Date(Date.UTC.apply(Date,d(i))),!1)===t&&(e._isReminderSent=!0)})}},{key:"setFinancialStatus",value:function(){this._financialStatus=this.isRepaymentValid?"Paid: "+this.amountPaid+" | Debt: "+this.outstandingDebt:"no detail!"}},{key:"generateAndSetNextSMSReminder",value:function(){var e=null;this.order.store_product&&(e=this.order.store_product.product_name);var t=this.order,r=t.repayment_amount,a=void 0;t.order_date===c.$getDate()?(a="Hello "+this.customerName+", thanks for patronizing us. The following is the breakdown of the repayment plan for the purchase of "+e+":%0a",this.dueDates.forEach(function(e,t){return a+=c.$getColumn(t+1)+": "+e+" => "+c.$formatCurrency(c.$roundDownAmt(r))+"%0a"})):a="Hello "+this.customerName+", This is to remind you that your "+c.$getColumn(parseInt(this.repaymentLevel)+1)+" repayment of "+c.$formatCurrency(c.$roundDownAmt(r))+" for "+e+" will be due on "+this.dueDates[this.repaymentLevel]+". we will be expecting you.",this._nextSMSReminder=a+"Please remember to pay on time to avoid late fees and other penalties.%0aThank you."}},{key:"setReminder",value:function(e){this._reminder={type:e,feedback:null,is_visited:null,dva_id:this.dvaId,order_id:this.order.id,customer_id:this.customer.id,canBeSelected:!this.isReminderSent,repayment_level:this.repaymentLevel+"/"+this.count},"sms"===e&&(this._reminder.sms_id=null,this._reminder.contacts=this.customer.telephone)}},{key:"setPromiseCall",value:function(){this._promiseCall={order_id:this.order.id,user_id:this.dvaId,customer_id:this.customer.id,date:null}}},{key:"isSelected",set:function(e){this._isSelected=e},get:function(){return this._isSelected}},{key:"isReminderSent",get:function(){return this._isReminderSent}},{key:"dvaId",get:function(){return this._dvaId}},{key:"financialStatus",get:function(){return this._financialStatus}},{key:"nextSMSReminder",get:function(){return this._nextSMSReminder}},{key:"reminder",get:function(){return this._reminder}},{key:"promiseCall",get:function(){return this._promiseCall}}]),t}();e.exports={Order:u,OrderWithPromiseCall:m}},rjj0:function(e,t,r){var a="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var s=r("tTVk"),n={},i=a&&(document.head||document.getElementsByTagName("head")[0]),o=null,d=0,l=!1,c=function(){},u=null,m="data-vue-ssr-id",v="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function _(e){for(var t=0;t<e.length;t++){var r=e[t],a=n[r.id];if(a){a.refs++;for(var s=0;s<a.parts.length;s++)a.parts[s](r.parts[s]);for(;s<r.parts.length;s++)a.parts.push(f(r.parts[s]));a.parts.length>r.parts.length&&(a.parts.length=r.parts.length)}else{var i=[];for(s=0;s<r.parts.length;s++)i.push(f(r.parts[s]));n[r.id]={id:r.id,refs:1,parts:i}}}}function h(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function f(e){var t,r,a=document.querySelector("style["+m+'~="'+e.id+'"]');if(a){if(l)return c;a.parentNode.removeChild(a)}if(v){var s=d++;a=o||(o=h()),t=g.bind(null,a,s,!1),r=g.bind(null,a,s,!0)}else a=h(),t=function(e,t){var r=t.css,a=t.media,s=t.sourceMap;a&&e.setAttribute("media",a);u.ssrId&&e.setAttribute(m,t.id);s&&(r+="\n/*# sourceURL="+s.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");if(e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,a),r=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else r()}}e.exports=function(e,t,r,a){l=r,u=a||{};var i=s(e,t);return _(i),function(t){for(var r=[],a=0;a<i.length;a++){var o=i[a];(d=n[o.id]).refs--,r.push(d)}t?_(i=s(e,t)):i=[];for(a=0;a<r.length;a++){var d;if(0===(d=r[a]).refs){for(var l=0;l<d.parts.length;l++)d.parts[l]();delete n[d.id]}}}};var p,y=(p=[],function(e,t){return p[e]=t,p.filter(Boolean).join("\n")});function g(e,t,r,a){var s=r?"":a.css;if(e.styleSheet)e.styleSheet.cssText=y(t,s);else{var n=document.createTextNode(s),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(n,i[t]):e.appendChild(n)}}},tTVk:function(e,t){e.exports=function(e,t){for(var r=[],a={},s=0;s<t.length;s++){var n=t[s],i=n[0],o={id:e+":"+s,css:n[1],media:n[2],sourceMap:n[3]};a[i]?a[i].parts.push(o):r.push(a[i]={id:i,parts:[o]})}return r}}});